<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        if (window.location.pathname.endsWith('/index.html')) {
            window.history.replaceState(null, '', '/');
        }
    </script>

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
        });
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5129097020907805" crossorigin="anonymous"></script>
    
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="canonical" href="https://tellmylocation.com/" />
    
    <meta name="author" content="Don Odibat, Founder & Chief Architect">
    <meta name="publisher" content="Don System Holdings">
    <meta name="copyright" content="2026 Don System Holdings">
    <meta name="date" content="2026-02-15">
    <meta name="web_author" content="Luna Shehab, Lead Developer">
    
    <title>Tell My Location | Global GPS & Safety Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <meta name="description" content="Instantly find your current coordinates, address, and local weather. A private, fast safety tool engineered by Don Odibat and Luna Shehab.">
    <meta name="keywords" content="gps coordinates, current location, my address, latitude longitude, emergency location, weather, ip address">
    
    <meta property="og:title" content="Tell My Location | Global GPS Tool">
    <meta property="og:description" content="Get your exact GPS coordinates, address, and nearest emergency services instantly.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tellmylocation.com">
    <meta property="og:image" content="https://tellmylocation.com/icon.png"> 
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Tell My Location",
      "url": "https://tellmylocation.com",
      "author": { "@type": "Person", "name": "Don Odibat", "jobTitle": "Founder & Chief Architect" },
      "maintainer": { "@type": "Person", "name": "Luna Shehab", "jobTitle": "Lead Developer" },
      "publisher": { "@type": "Organization", "name": "Don System Holdings" },
      "applicationCategory": "Utility",
      "operatingSystem": "Any",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
      "featureList": "GPS Coordinates, Address Lookup, Weather, SOS Sharing, Nearby Services"
    }
    </script>

    <style>
        :root { --card: rgba(13, 17, 23, 0.85); --accent: #ff0055; --neon-blue: #38bdf8; --sos-red: #ef4444; --text-main: #ffffff; --text-soft: #94a3b8; --border: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #111827 100%); background-attachment: fixed; color: var(--text-main); min-height: 100vh; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .shell { width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 16px; position: relative; }
        .lang-switch { position: absolute; top: 0; right: 0; z-index: 10; }
        select#language { background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border); padding: 5px 10px; border-radius: 8px; font-size: 12px; cursor: pointer; outline: none; } select#language option { background: #0f172a; color: white; }
        body.rtl { direction: rtl; } body.rtl .lang-switch { right: auto; left: 0; } body.rtl .copy-abs { right: auto; left: 12px; } body.rtl #full-address { padding-right: 0; padding-left: 30px; } body.rtl .data-item, body.rtl .nearby-item { text-align: right; }
        .brand { text-align: center; margin: 30px 0 15px; } .brand a { text-decoration: none; color: inherit; } .brand h1 { font-size: 28px; font-weight: 800; letter-spacing: -1px; margin-bottom: 6px; text-shadow: 0 4px 20px rgba(0,0,0,0.5); } .brand h1 span { color: var(--accent); } .tagline { color: var(--text-soft); font-size: 14px; font-weight: 400; }
        .card { background: var(--card); backdrop-filter: blur(12px); border-radius: 24px; border: 1px solid var(--border); padding: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .address-box { background: rgba(56, 189, 248, 0.05); border: 1px solid rgba(56, 189, 248, 0.2); padding: 18px; border-radius: 16px; margin-bottom: 20px; text-align: center; position: relative; } .address-box h2 { font-size: 11px; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; font-weight: 700; } #full-address { font-size: 16px; font-weight: 600; line-height: 1.5; color: #fff; padding-right: 30px; }
        .icon-btn { background: none; border: none; cursor: pointer; color: var(--neon-blue); padding: 5px; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; } .icon-btn:hover { transform: scale(1.1); } .copy-abs { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); }
        #map { width: 100%; height: 320px; border-radius: 18px; border: 1px solid var(--border); margin-bottom: 20px; z-index: 1; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px; } .data-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 16px; border-radius: 16px; text-align: left; } .label { font-size: 10px; color: var(--text-soft); text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px; } .value { font-size: 16px; font-weight: 700; color: #fff; } .sub-value { font-size: 11px; color: var(--neon-blue); margin-top: 4px; }
        .nearby-header { font-size: 12px; text-transform: uppercase; color: var(--text-soft); margin-bottom: 10px; letter-spacing: 0.5px; display: flex; align-items: center; gap: 6px; } .nearby-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; } @media(max-width: 600px) { .nearby-list { grid-template-columns: 1fr; } } .nearby-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 12px; border-radius: 12px; } .nearby-type { font-size: 9px; color: var(--accent); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; } .nearby-name { font-size: 13px; font-weight: 600; color: #f1f5f9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } .nearby-dist { font-size: 11px; color: var(--neon-blue); }
        .btn-stack { display: flex; flex-direction: column; gap: 12px; margin-top: 30px; } .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; } .btn { border: none; border-radius: 14px; padding: 16px; font-weight: 700; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform 0.1s; } .btn-sos { background: var(--sos-red); color: white; width: 100%; font-size: 16px; box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); } .btn-primary { background: linear-gradient(135deg, #ff0055, #ff4d7d); color: white; } .btn-ghost { background: rgba(255,255,255,0.05); color: white; border: 1px solid var(--border); } .btn:active { transform: scale(0.98); } .icon { width: 18px; height: 18px; stroke-width: 2.5; }
        .trust-badge { font-size: 12px; color: #94a3b8; text-align: center; margin-top: 25px; line-height: 1.6; background: rgba(15, 23, 42, 0.5); padding: 15px; border-radius: 12px; border: 1px dashed var(--border); }
        footer { margin-top: 40px; text-align: center; font-size: 12px; color: var(--text-soft); padding-bottom: 30px; border-top: 1px solid var(--border); width: 100%; padding-top: 20px;} footer a { color: var(--text-soft); text-decoration: none; margin: 0 8px; transition: color 0.2s; } footer a:hover { color: white; }
        #cookie-banner { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(15, 23, 42, 0.98); border-top: 1px solid var(--border); box-shadow: 0 -10px 40px rgba(0,0,0,0.8); z-index: 10000; padding: 20px; text-align: center; backdrop-filter: blur(10px); } .cookie-content { max-width: 600px; margin: 0 auto; } #cookie-text { margin-bottom: 15px; font-size: 13px; color: #cbd5e1; line-height: 1.5; } .cookie-buttons { display: flex; gap: 10px; justify-content: center; } .cookie-btn { border: none; padding: 10px 24px; border-radius: 50px; font-weight: 700; cursor: pointer; font-size: 13px; transition: 0.2s; } .btn-accept { background: var(--neon-blue); color: #0f172a; } .btn-accept:hover { background: white; } .btn-reject { background: transparent; border: 1px solid var(--text-soft); color: var(--text-soft); } .btn-reject:hover { border-color: white; color: white; }
        .premium-upgrade-container { animation: fadeIn 1.2s ease-out; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .qr-section { text-align: center; margin-bottom: 25px; background: rgba(255,255,255,0.02); padding: 20px; border-radius: 20px; border: 1px solid var(--border); } .qr-label { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--neon-blue); margin-bottom: 10px; font-weight: 800; } #qrcode { display: inline-block; padding: 10px; background: white; border-radius: 12px; box-shadow: 0 0 20px rgba(56, 189, 248, 0.3); }
        .premium-dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin: 20px 0; } .p-card { background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01)); border: 1px solid var(--border); padding: 20px; border-radius: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: default; } .p-card:hover { border-color: var(--neon-blue); transform: scale(1.05); box-shadow: 0 10px 30px rgba(56,189,248,0.1); } .p-icon { font-size: 20px; margin-bottom: 10px; display: block; opacity: 0.8; } .p-label { font-size: 10px; text-transform: uppercase; color: var(--text-soft); } .p-value { font-size: 18px; font-weight: 800; color: white; display: block; margin-top: 5px; }
        .compass-wrap { position: relative; width: 220px; height: 220px; margin: 30px auto; background: radial-gradient(circle, rgba(56, 189, 248, 0.1) 0%, transparent 70%); border-radius: 50%; padding: 10px; } #compass-svg { width: 100%; height: 100%; transition: transform 0.1s linear; filter: drop-shadow(0 0 10px var(--neon-blue)); } .compass-ring { fill: none; stroke: var(--border); stroke-width: 2; } .compass-glow { fill: none; stroke: var(--neon-blue); stroke-width: 1; opacity: 0.5; }
        .use-case-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 40px; } .use-case-card { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 20px; border-radius: 18px; text-align: center; transition: 0.3s; cursor: pointer; } .use-case-card:hover { background: rgba(255,255,255,0.05); border-color: var(--accent); transform: translateY(-2px); } .use-case-card h3 { font-size: 13px; text-transform: uppercase; margin-top: 10px; color: var(--text-main); }
        .why-section { padding: 30px; background: linear-gradient(to right, rgba(56,189,248,0.05), transparent); border-left: 3px solid var(--neon-blue); border-radius: 12px; margin: 40px 0; } .why-section h2 { font-size: 18px; color: var(--neon-blue); margin-bottom: 10px; } .why-section p { font-size: 14px; color: var(--text-soft); line-height: 1.6; }
        .nav-menu { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; background: rgba(15, 23, 42, 0.6); padding: 10px 20px; border-radius: 50px; border: 1px solid var(--border); backdrop-filter: blur(5px); } .nav-menu a { color: var(--text-soft); text-decoration: none; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: color 0.3s; } .nav-menu a:hover, .nav-menu a.active { color: var(--neon-blue); }
        .hidden-page { display: none; margin-top: 20px; animation: fadeIn 0.5s ease; }
        .new-module-container { display: none; margin-top: 20px; padding: 20px; border-radius: 16px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); text-align: left; } .new-module-container.active-mod { display: block; animation: slideDown 0.3s ease-out; } @keyframes slideDown { from {opacity:0; transform:translateY(-10px);} to {opacity:1; transform:translateY(0);} }
        .mod-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; } .mod-title { font-size: 16px; font-weight: 700; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1px; } .mod-close { cursor: pointer; color: var(--text-soft); font-size: 18px; background: none; border: none; }
        .mod-grid-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; } .mod-btn { padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: white; cursor: pointer; font-size: 13px; transition: 0.2s; } .mod-btn:hover { background: rgba(255,255,255,0.1); border-color: var(--neon-blue); } .mod-btn-primary { background: var(--neon-blue); color: #0f172a; border: none; font-weight: 700; } .mod-btn-danger { background: var(--sos-red); color: white; border: none; font-weight: 700; }
        .mod-input { width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 10px; outline: none; } .mod-input:focus { border-color: var(--neon-blue); }
        .sos-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(30, 0, 0, 0.95); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; } .sos-msg { font-size: 24px; font-weight: 900; color: white; margin-bottom: 30px; text-align: center; padding: 20px; }
        .driver-hud { display: flex; justify-content: space-around; margin: 15px 0; background: rgba(0,0,0,0.4); padding: 15px; border-radius: 12px; } .hud-item { text-align: center; } .hud-val { font-size: 24px; font-weight: 800; color: white; display: block; } .hud-lbl { font-size: 10px; text-transform: uppercase; color: var(--text-soft); }
        .pin-list { margin-top: 10px; max-height: 150px; overflow-y: auto; } .pin-item { padding: 8px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 12px; } .offline-badge { display: inline-block; padding: 4px 8px; background: #64748b; color: white; font-size: 10px; border-radius: 4px; margin-left: 10px; vertical-align: middle; display: none; }
        .ad-container { border-radius: 12px; background: rgba(255,255,255,0.02); border: 1px dashed var(--border); display: flex; align-items: center; justify-content: center; flex-direction: column; }
        
        /* FEATURE GRID CSS */
        .feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 40px 0; }
        .feature-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid var(--border); text-align: left; }
        .f-icon { font-size: 24px; margin-bottom: 10px; display: block; }
        .f-title { font-weight: 700; color: white; margin-bottom: 5px; display: block; }
        .f-desc { font-size: 13px; color: var(--text-soft); line-height: 1.5; }
        @media(max-width: 600px) { .feature-grid { grid-template-columns: 1fr; } }
        
        .specs-table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 13px; }
        .specs-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); color: #cbd5e1; }
        .specs-table tr:last-child td { border-bottom: none; }
        .spec-label { font-weight: 700; color: var(--accent); width: 40%; }
    </style>
</head>
<body>

<div class="shell premium-upgrade-container">

    <nav class="nav-menu">
        <a href="/" class="active">Home</a>
        <a href="guides.html">Guides</a>
        <a href="about.html">About</a>
        <a href="privacy.html">Privacy</a>
        <a href="contact.html">Contact</a>
    </nav>

    <div id="home-view">
        <div class="lang-switch">
            <select id="language" onchange="changeLanguage(this.value)">
                <option value="en">üá∫üá∏ English</option>
                <option value="es">üá™üá∏ Espa√±ol</option>
                <option value="fr">üá´üá∑ Fran√ßais</option>
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            </select>
        </div>

        <header class="brand">
            <a href="/" style="color:inherit; text-decoration:none;">
                <h1>TELLMY<span>LOCATION</span>.COM <span id="offline-indicator" class="offline-badge">OFFLINE MODE</span></h1>
            </a>
            <p class="tagline" data-i18n="tagline">Instant, Private, & Accurate</p>
        </header>

        <div class="compass-wrap">
            <svg id="compass-svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="48" class="compass-ring"/>
                <circle cx="50" cy="50" r="45" class="compass-glow" stroke-dasharray="5,5"/>
                <text x="50" y="12" fill="#38bdf8" font-size="8" text-anchor="middle" font-weight="900">N</text>
                <text x="50" y="93" fill="#94a3b8" font-size="6" text-anchor="middle">S</text>
                <text x="88" y="52" fill="#94a3b8" font-size="6" text-anchor="middle">E</text>
                <text x="12" y="52" fill="#94a3b8" font-size="6" text-anchor="middle">W</text>
                <path d="M50 20 L55 50 L50 80 L45 50 Z" fill="#ff0055" />
                <circle cx="50" cy="50" r="3" fill="white" />
            </svg>
        </div>

        <main class="card">
            <div class="address-box">
                <h2 data-i18n="address_title">üìç Current Address</h2>
                <div id="full-address">...</div>
                <div style="font-size:10px; color:rgba(255,255,255,0.5); margin-top:5px;">(Tap copy icon to save)</div>
                <button class="icon-btn copy-abs" id="copy-addr" title="Copy Address">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </button>
            </div>

            <div style="text-align:center; font-size:11px; color:#94a3b8; margin-bottom:15px;">
                Your location is processed locally on your device. Nothing is stored.
            </div>

            <div id="map"></div>

            <div class="card" style="margin-top: 15px; padding: 15px; border: 1px solid var(--border);">
                <h3 style="color:var(--neon-blue); font-size:14px; margin-bottom:15px;">üå¶Ô∏è Real-Time Weather</h3>
                <div id="weather-loading" style="color:var(--text-soft); font-size:12px;">Loading weather data...</div>
                <div id="weather-content" style="display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <div>
                            <div id="wx-temp" style="font-size:32px; font-weight:800; color:white;">--¬∞</div>
                            <div id="wx-desc" style="color:var(--text-soft); font-size:14px;">Unknown</div>
                        </div>
                        <div style="text-align:right; font-size:12px; color:#cbd5e1;">
                            <div>üí® Wind: <span id="wx-wind">--</span></div>
                            <div>üíß Hum: <span id="wx-hum">--</span></div>
                            <div>‚òÄÔ∏è UV: <span id="wx-uv">--</span></div>
                        </div>
                    </div>
                    <div style="font-size:11px; color:var(--text-soft); text-transform:uppercase; margin-bottom:10px;">24-Hour Forecast</div>
                    <div id="wx-hourly" style="display:flex; overflow-x:auto; gap:10px; padding-bottom:10px; scrollbar-width:thin;"></div>
                </div>
            </div>
            <div class="card" id="wx-alert-panel" style="margin-top: 15px; padding: 15px; border-left: 4px solid #10b981; background:rgba(16, 185, 129, 0.05);">
                <h3 style="color:white; font-size:14px; margin-bottom:5px;">‚ö†Ô∏è Weather Alerts</h3>
                <div id="wx-alert-msg" style="color:#cbd5e1; font-size:13px;">Clear ‚Äî No warnings active.</div>
                <div style="font-size:10px; color:var(--text-soft); margin-top:5px;">Always find shelter if conditions worsen.</div>
            </div>
            <div class="premium-dashboard">
                <div class="p-card"><span class="p-icon">üõ∞Ô∏è</span><span class="p-label">Altitude</span><span class="p-value" id="alt-p">‚Äî</span></div>
                <div class="p-card"><span class="p-icon">üß≠</span><span class="p-label">Bearing</span><span class="p-value" id="head-p">‚Äî</span></div>
                <div class="p-card"><span class="p-icon">üõ°Ô∏è</span><span class="p-label">Connection</span><span class="p-value">Secure</span></div>
                <div class="p-card"><span class="p-icon">üïí</span><span class="p-label">Timestamp</span><span class="p-value" id="time-p">00:00:00</span></div>
            </div>

            <div class="data-grid">
                <div class="data-item">
                    <div class="label" data-i18n="gps_label">üåç GPS Coordinates <span style="float:right; color:#10b981; font-weight:bold;">Accuracy: High</span></div>
                    <div class="value"><span id="lat-val">‚Äî</span>, <span id="lng-val">‚Äî</span></div>
                    <div class="sub-value" id="accuracy-val">...</div>
                    <div style="font-size:10px; color:#64748b; margin-top:4px;">(Tap coordinates to copy)</div>
                    <div style="margin-top:8px; display:flex; gap:5px;">
                        <button class="mod-btn" style="padding:5px 10px; font-size:10px;" onclick="openDirectMap()">Google Maps</button>
                        <button class="mod-btn" style="padding:5px 10px; font-size:10px;" onclick="toggleModule('share-mod')">Share Location</button>
                    </div>
                </div>
                <div class="data-item">
                    <div class="label" data-i18n="weather_label">‚òÅÔ∏è Weather</div>
                    <div class="value" id="temp-display">‚Äî</div>
                    <div class="sub-value" id="wind-display">Wind: ‚Äî</div>
                    <div style="font-size:10px; color:#64748b; margin-top:4px;">(Auto-updates live)</div>
                </div>
                <div class="data-item">
                    <div class="label" data-i18n="ip_label">üåê Network IP</div>
                    <div class="value" id="ip-val" style="font-size:14px">‚Äî</div>
                    <div class="sub-value" id="isp-val">ISP: ‚Äî</div>
                </div>
            </div>

            <div class="ad-container" style="text-align:center; margin: 20px 0; min-height: 90px; width: 100%; overflow: hidden;">
                 <span style="font-size:10px; color:#334155; margin-bottom: 5px;">ADVERTISEMENT</span>
                 
                 <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-5129097020907805"
                     data-ad-slot="1234567890"  
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                 <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                 </script>
            </div>

            <div class="nearby-header">
                <svg style="width:14px;height:14px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                <span data-i18n="nearby_label">üì° Nearest Emergency Services</span>
            </div>
            <div class="nearby-list" id="nearby-results">
                <div class="nearby-item">...</div>
                <div class="nearby-item">...</div>
                <div class="nearby-item">...</div>
            </div>
            
            <div class="card" style="margin-top: 20px; padding: 15px; border: 1px solid var(--border);">
                <h3 style="color:white; font-size:14px; margin-bottom:10px;">üó∫Ô∏è Location Preview</h3>
                <div id="mini-map" style="height:150px; border-radius:12px; margin-bottom:10px; z-index:0;"></div>
                <div style="display:flex; gap:10px;">
                    <button class="mod-btn" style="flex:1; font-size:11px;" onclick="if(window.mapPreview && window.lastLat){ window.mapPreview.setView([window.lastLat, window.lastLng], 15); }">‚¨á Recenter Map</button>
                    <button class="mod-btn" style="flex:1; font-size:11px;" onclick="if(window.lastLat){ window.open('https://www.google.com/maps?q=' + window.lastLat + ',' + window.lastLng, '_blank'); }">Open Full Map</button>
                </div>
            </div>
            <div class="btn-stack">
                <button class="btn btn-sos" id="sos-btn">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                    <span data-i18n="btn_sos">SHARE LOCATION (SOS)</span>
                </button>
                <div class="btn-row">
                    <button class="btn btn-primary" id="refresh-btn">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        <span data-i18n="btn_refresh">Refresh</span>
                    </button>
                    <button class="btn btn-ghost" id="copy-coords-btn">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        <span data-i18n="btn_copy">Copy Lat/Long</span>
                    </button>
                </div>
                
                <div class="btn-row" style="margin-top:10px;">
                    <button class="btn" onclick="toggleModule('driver-mod')" style="background:rgba(56, 189, 248, 0.15); color:#38bdf8; border:1px solid rgba(56, 189, 248, 0.3);"><span>üöó Driver Mode</span></button>
                    <button class="btn" onclick="toggleModule('hiker-mod')" style="background:rgba(16, 185, 129, 0.15); color:#10b981; border:1px solid rgba(16, 185, 129, 0.3);"><span>üå≤ Hiker Mode</span></button>
                </div>
                <div class="btn-row" style="margin-top:0px;">
                    <button class="btn" onclick="toggleModule('friend-mod')" style="background:rgba(255, 204, 0, 0.15); color:#fbbf24; border:1px solid rgba(255, 204, 0, 0.3);"><span>ü§ù Meet Friend</span></button>
                    <button class="btn" onclick="toggleModule('share-mod')" style="background:rgba(255, 255, 255, 0.1); color:white; border:1px solid rgba(255, 255, 255, 0.3);"><span>üîó Share Link</span></button>
                </div>
            </div>

            <div class="qr-section">
                <div class="qr-label">Scan to Share Location</div>
                <div id="qrcode"></div>
            </div>

            <div id="new-modules-container">
                <div id="driver-mod" class="new-module-container">
                    <div class="mod-header"><span class="mod-title">Driver Dashboard</span><button class="mod-close" onclick="toggleModule('driver-mod')">‚úï</button></div>
                    <div class="driver-hud"><div class="hud-item"><span class="hud-val" id="drv-speed">0</span><span class="hud-lbl">MPH</span></div><div class="hud-item"><span class="hud-val" id="drv-dir">--</span><span class="hud-lbl">Heading</span></div></div>
                    <div class="mod-grid-buttons">
                        <button class="mod-btn" onclick="openMapSearch('gas_station')">‚õΩ Gas Stations</button>
                        <button class="mod-btn" onclick="openMapSearch('parking')">üÖøÔ∏è Rest Stops</button>
                        <button class="mod-btn" onclick="shareETA()">‚è±Ô∏è Send ETA</button>
                        <button class="mod-btn" onclick="shareLocationSimple()">üìç Share Location</button>
                    </div>
                </div>
                <div id="hiker-mod" class="new-module-container">
                    <div class="mod-header"><span class="mod-title">Hiker Tools</span><button class="mod-close" onclick="toggleModule('hiker-mod')">‚úï</button></div>
                    <div style="font-size:12px; color:#94a3b8; margin-bottom:10px;">Offline caching enabled. Pins saved locally.</div>
                    <div class="mod-grid-buttons">
                        <button class="mod-btn mod-btn-primary" onclick="dropPin()">üìç Drop Pin</button>
                        <button class="mod-btn" onclick="clearPins()">üóëÔ∏è Clear Pins</button>
                    </div>
                    <div id="pin-list" class="pin-list"></div>
                </div>
                <div id="friend-mod" class="new-module-container">
                    <div class="mod-header"><span class="mod-title">Meet a Friend</span><button class="mod-close" onclick="toggleModule('friend-mod')">‚úï</button></div>
                    <input type="text" id="friend-input" class="mod-input" placeholder="Paste friend's coords (lat,lng) or link...">
                    <button class="mod-btn mod-btn-primary" style="width:100%" onclick="calcFriendDist()">Calculate Distance & Midpoint</button>
                    <div id="friend-res" style="margin-top:10px; font-size:14px; color:white;"></div>
                </div>
                <div id="share-mod" class="new-module-container">
                    <div class="mod-header"><span class="mod-title">Share Location</span><button class="mod-close" onclick="toggleModule('share-mod')">‚úï</button></div>
                    <input type="text" id="share-url-input" class="mod-input" readonly>
                    <div class="mod-grid-buttons">
                        <button class="mod-btn mod-btn-primary" onclick="copyShareLink()">üìã Copy Link</button>
                        <button class="mod-btn" onclick="startLiveTrack()" id="live-trk-btn">üì° Start Live (15m)</button>
                    </div>
                    <div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                        <button class="mod-btn" onclick="shareSocial('wa')">WhatsApp</button>
                        <button class="mod-btn" onclick="shareSocial('sms')">SMS</button>
                        <button class="mod-btn" onclick="shareSocial('tg')">Telegram</button>
                    </div>
                </div>
            </div>

            <div class="ad-container" style="text-align:center; margin: 30px 0; min-height: 250px; width: 100%; overflow: hidden;">
                 <span style="font-size:10px; color:#334155; margin-bottom: 5px;">ADVERTISEMENT</span>
                 
                 <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-5129097020907805"
                     data-ad-slot="0987654321"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                 <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                 </script>
            </div>

            <div class="feature-grid">
                <div class="feature-box">
                    <span class="f-icon">üîí</span>
                    <span class="f-title">Zero Logs</span>
                    <span class="f-desc">Unlike standard map apps, we do not store your history. When you close this tab, your location data is deleted from memory.</span>
                </div>
                <div class="feature-box">
                    <span class="f-icon">‚ö°</span>
                    <span class="f-title">Offline Capable</span>
                    <span class="f-desc">Our PWA technology means the core GPS logic works even without a data signal, critical for hikers and sailors.</span>
                </div>
            </div>

            <div class="card" style="margin-top:30px; padding:20px; border-color:var(--accent);">
                <h3 style="color:white; font-size:16px; margin-bottom:15px;">üõ†Ô∏è Technical Specifications</h3>
                <table class="specs-table">
                    <tr><td class="spec-label">API Standard</td><td>W3C Geolocation Level 2</td></tr>
                    <tr><td class="spec-label">Encryption</td><td>TLS 1.3 (HTTPS)</td></tr>
                    <tr><td class="spec-label">Coordinate System</td><td>WGS84 (Decimal Degrees)</td></tr>
                    <tr><td class="spec-label">Data Retention</td><td>0 Seconds (Ephemeral)</td></tr>
                </table>
            </div>

            <div class="card" style="margin-top: 30px; padding: 20px; border: 1px solid var(--accent);">
                <h3 style="color:white; font-size:16px; margin-bottom:15px;">üìö Location Guides</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <a href="guide-safety.html" style="text-decoration:none;">
                        <div class="nearby-item" style="height:100%; display:flex; flex-direction:column; justify-content:center; text-align:center; transition:0.3s; cursor:pointer; background:rgba(56, 189, 248, 0.1);">
                            <div style="font-size:24px; margin-bottom:5px;">üö®</div>
                            <div style="color:white; font-weight:700; font-size:13px;">Emergency GPS Protocol</div>
                            <div style="color:var(--text-soft); font-size:10px; margin-top:5px;">How to signal for help offline.</div>
                        </div>
                    </a>
                    <a href="guide-accuracy.html" style="text-decoration:none;">
                        <div class="nearby-item" style="height:100%; display:flex; flex-direction:column; justify-content:center; text-align:center; transition:0.3s; cursor:pointer; background:rgba(56, 189, 248, 0.1);">
                            <div style="font-size:24px; margin-bottom:5px;">üéØ</div>
                            <div style="color:white; font-weight:700; font-size:13px;">Fix Location Accuracy</div>
                            <div style="color:var(--text-soft); font-size:10px; margin-top:5px;">Why GPS drift happens.</div>
                        </div>
                    </a>
                </div>
            </div>

            <p class="trust-badge">
                <span data-i18n="trust_text">üîí Privacy Guarantee: We do not save, need, or share your location. This website exists solely to help you or save you when needed. All data is processed securely on your device.</span>
            </p>
        </main>
    </div>

    <div id="sos-overlay" class="sos-overlay">
        <div class="sos-msg">LOCATION SHARE READY</div>
        <button class="mod-btn" style="background:white; color:red; padding:20px 40px; font-size:18px;" onclick="stopSOS()">CANCEL</button>
        <div style="margin-top:20px; color:white;">Select a contact to share...</div>
    </div>

    <footer>
        <div style="margin-bottom: 15px; font-size: 11px;">
            <a href="guide-safety.html" style="color:var(--neon-blue);">Emergency Guide</a> ‚Ä¢ 
            <a href="guide-accuracy.html" style="color:var(--neon-blue);">GPS Accuracy Fix</a> ‚Ä¢
            <a href="https://waterinmyspeaker.com" target="_blank" style="color:#94a3b8;">Speaker Cleaner</a> ‚Ä¢
            <a href="https://buymeacoffee.com/donshehab" target="_blank" style="color:#94a3b8;">Support Us</a>
        </div>
        <div style="margin-bottom: 12px;">
            <a href="privacy.html" data-i18n="link_privacy">Privacy Policy</a> ‚Ä¢ 
            <a href="terms.html" data-i18n="link_terms">Terms of Use</a> ‚Ä¢ 
            <a href="contact.html" data-i18n="link_contact">Contact Us</a> ‚Ä¢
            <a href="#" onclick="showCookieBanner(); return false;">Cookie Preferences</a>
        </div>
        ¬© 2026 TellMyLocation.com
    </footer>
</div>

<div id="cookie-banner">
    <div class="cookie-content">
        <div id="cookie-text" data-i18n="cookie_text">We use cookies to analyze traffic and show personalized ads to support this free tool.</div>
        <div class="cookie-buttons">
            <button class="cookie-btn btn-reject" onclick="rejectCookies()">Decline</button>
            <button class="cookie-btn btn-accept" onclick="acceptCookies()" data-i18n="btn_accept">Accept All</button>
        </div>
    </div>
</div>

<script>
    /* DEBOUNCE UTILITY (The "Brakes") */
    let debounceTimer;
    function debounce(func, timeout = 1000){
        return (...args) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => { func.apply(this, args); }, timeout);
        };
    }

    function openDirectMap() {
        if (!currentPos) return alert("Waiting for location...");
        window.open(`https://www.google.com/maps?q=${currentPos.lat},${currentPos.lng}`, '_blank');
    }

    // Generate QR Code
    new QRCode(document.getElementById("qrcode"), {
        text: window.location.href,
        width: 100,
        height: 100,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
    });

    // Real-time Compass Orientation logic
    window.addEventListener('deviceorientation', function(event) {
        if (event.webkitCompassHeading) {
            document.getElementById('compass-svg').style.transform = `rotate(${-event.webkitCompassHeading}deg)`;
            document.getElementById('head-p').textContent = Math.round(event.webkitCompassHeading) + '¬∞';
        } else if (event.alpha) {
            document.getElementById('compass-svg').style.transform = `rotate(${-event.alpha}deg)`;
            document.getElementById('head-p').textContent = Math.round(event.alpha) + '¬∞';
        }
    }, true);

    // Update Premium Dashboard Clock
    setInterval(() => {
        const now = new Date();
        document.getElementById('time-p').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
    }, 1000);

    /* ORIGINAL SCRIPT CONTINUES BELOW */
    const i18n = {
        en: {
            tagline: "Instant, Private, & Accurate",
            address_title: "Current Address",
            gps_label: "GPS Coordinates",
            weather_label: "Weather",
            ip_label: "Network IP",
            nearby_label: "Nearest Emergency Services",
            btn_sos: "SHARE LOCATION (SOS)",
            btn_refresh: "Refresh",
            btn_copy: "Copy Lat/Long",
            btn_coffee: "Buy Me a Coffee",
            trust_text: "üîí Privacy Guarantee: We do not save, need, or share your location. This website exists solely to help you or save you when needed. All data is processed securely on your device.",
            link_privacy: "Privacy Policy", link_terms: "Terms of Use", link_contact: "Contact Us",
            cookie_text: "We use cookies to analyze traffic and show personalized ads to support this free tool.",
            btn_accept: "Accept All"
        },
        es: {
            tagline: "Instant√°neo, Privado y Preciso",
            address_title: "Direcci√≥n Actual",
            gps_label: "Coordenadas GPS",
            weather_label: "Clima",
            ip_label: "IP de Red",
            nearby_label: "Servicios de Emergencia",
            btn_sos: "COMPARTIR UBICACI√ìN (SOS)",
            btn_refresh: "Actualizar",
            btn_copy: "Copiar Lat/Long",
            btn_coffee: "Inv√≠tame un Caf√©",
            trust_text: "üîí Garant√≠a de Privacidad: No guardamos, necesitamos ni compartimos tu ubicaci√≥n. Este sitio existe solo para ayudarte o salvarte cuando sea necesario.",
            link_privacy: "Privacidad", link_terms: "T√©rminos", link_contact: "Contacto",
            cookie_text: "Usamos cookies para analizar el tr√°fico y mostrar anuncios personalizados.",
            btn_accept: "Aceptar"
        },
        fr: {
            tagline: "Instantan√©, Priv√© et Pr√©cis",
            address_title: "Adresse Actuelle",
            gps_label: "Coordonn√©es GPS",
            weather_label: "M√©t√©o",
            ip_label: "IP R√©seau",
            nearby_label: "Services d'Urgence Proches",
            btn_sos: "PARTAGER POSITION (SOS)",
            btn_refresh: "Actualiser",
            btn_copy: "Copiar Lat/Long",
            btn_coffee: "Offrez-moi un caf√©",
            trust_text: "üîí Garantie de Confidentialit√© : Nous n'enregistrons ni ne partageons votre localisation. Ce site existe uniquement pour vous aider ou vous sauver en cas de besoin.",
            link_privacy: "Confidentialit√©", link_terms: "Conditions", link_contact: "Contact",
            cookie_text: "Nous utilisons des cookies pour analyser le trafic et afficher des publicit√©s.",
            btn_accept: "Accepter"
        },
        ru: {
            tagline: "–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ, –ø—Ä–∏–≤–∞—Ç–Ω–æ –∏ —Ç–æ—á–Ω–æ",
            address_title: "–¢–µ–∫—É—â–∏–π –∞–¥—Ä–µ—Å",
            gps_label: "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã GPS",
            weather_label: "–ü–æ–≥–æ–¥–∞",
            ip_label: "IP-–∞–¥—Ä–µ—Å —Å–µ—Ç–∏",
            nearby_label: "–ë–ª–∏–∂–∞–π—à–∏–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–ª—É–∂–±—ã",
            btn_sos: "–ü–û–î–ï–õ–ò–¢–¨–°–Ø (SOS)",
            btn_refresh: "–û–±–Ω–æ–≤–∏—Ç—å",
            btn_copy: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
            btn_coffee: "–ö—É–ø–∏—Ç—å –º–Ω–µ –∫–æ—Ñ–µ",
            trust_text: "üîí –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: –ú—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ—Ç —Å–∞–π—Ç —Å–æ–∑–¥–∞–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤–∞–º –≤ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.",
            link_privacy: "–ü–æ–ª–∏—Ç–∏–∫–∞", link_terms: "–£—Å–ª–æ–≤–∏—è", link_contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
            cookie_text: "–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–π–ª—ã cookie –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –ø–æ–∫–∞–∑–∞ —Ä–µ–∫–ª–∞–º—ã.",
            btn_accept: "–ü—Ä–∏–Ω—è—Ç—å"
        },
        ar: {
            tagline: "ŸÅŸàÿ±Ÿäÿå ÿÆÿßÿµÿå ŸàÿØŸÇŸäŸÇ",
            address_title: "ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑÿ≠ÿßŸÑŸä",
            gps_label: "ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ GPS",
            weather_label: "ÿßŸÑÿ∑ŸÇÿ≥",
            ip_label: "ÿπŸÜŸàÿßŸÜ IP",
            nearby_label: "ÿ£ŸÇÿ±ÿ® ÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶",
            btn_sos: "ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÖŸàŸÇÿπ (SOS)",
            btn_refresh: "ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
            btn_copy: "ŸÜÿ≥ÿÆ ÿßŸÑÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™",
            btn_coffee: "ÿØÿπŸÖ ÿßŸÑŸÖŸàŸÇÿπ (ŸÇŸáŸàÿ©)",
            trust_text: "üîí ÿ∂ŸÖÿßŸÜ ÿßŸÑÿÆÿµŸàÿµŸäÿ©: ŸÜÿ≠ŸÜ ŸÑÿß ŸÜÿ≠ŸÅÿ∏ ŸÖŸàŸÇÿπŸÉ ÿ£Ÿà ŸÜÿ≠ÿ™ÿßÿ¨ ÿ•ŸÑŸäŸá ÿ£Ÿà ŸÜÿ¥ÿßÿ±ŸÉŸá. Ÿáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ ŸÖŸàÿ¨ŸàÿØ ŸÅŸÇÿ∑ ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿ£Ÿà ÿ•ŸÜŸÇÿßÿ∞ŸÉ ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©. ÿ™ÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿ£ŸÖÿßŸÜ ÿπŸÑŸâ ÿ¨Ÿáÿßÿ≤ŸÉ.",
            link_privacy: "ÿßŸÑÿÆÿµŸàÿµŸäÿ©", link_terms: "ÿßŸÑÿ¥ÿ±Ÿàÿ∑", link_contact: "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß",
            cookie_text: "ŸÜÿ≠ŸÜ ŸÜÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÑŸÅÿßÿ™ ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿßÿ±ÿ™ÿ®ÿßÿ∑ ŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿàÿπÿ±ÿ∂ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™.",
            btn_accept: "ŸÇÿ®ŸàŸÑ"
        }
    };

    function changeLanguage(lang) {
        localStorage.setItem('user_lang', lang);
        if (lang === 'ar') { document.body.classList.add('rtl'); } else { document.body.classList.remove('rtl'); }
        const texts = i18n[lang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (texts[key]) el.textContent = texts[key];
        });
    }

    const savedLang = localStorage.getItem('user_lang') || 'en';
    document.getElementById('language').value = savedLang;
    changeLanguage(savedLang);

    // --- CONSENT LOGIC START ---
    function checkConsent() {
        const consent = localStorage.getItem('cookiesAccepted');
        if (!consent) {
            document.getElementById('cookie-banner').style.display = 'block';
        } else if (consent === 'granted') {
            gtag('consent', 'update', {
                'ad_storage': 'granted',
                'ad_user_data': 'granted',
                'ad_personalization': 'granted',
                'analytics_storage': 'granted'
            });
        }
        // If 'denied', we do nothing (default is denied)
    }

    function acceptCookies() {
        localStorage.setItem('cookiesAccepted', 'granted');
        document.getElementById('cookie-banner').style.display = 'none';
        gtag('consent', 'update', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
        });
    }

    function rejectCookies() {
        localStorage.setItem('cookiesAccepted', 'denied');
        document.getElementById('cookie-banner').style.display = 'none';
        // Explicitly set denied just in case
        gtag('consent', 'update', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
        });
    }

    function showCookieBanner() {
        document.getElementById('cookie-banner').style.display = 'block';
    }

    // Run check on load
    checkConsent();
    // --- CONSENT LOGIC END ---

    const els = {
        lat: document.getElementById("lat-val"),
        lng: document.getElementById("lng-val"),
        addr: document.getElementById("full-address"),
        acc: document.getElementById("accuracy-val"),
        temp: document.getElementById("temp-display"),
        wind: document.getElementById("wind-display"),
        ip: document.getElementById("ip-val"),
        isp: document.getElementById("isp-val"),
        nearby: document.getElementById("nearby-results")
    };

    let map, marker, accuracyCircle, currentPos = null;

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; 
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const km = R * c;
        return { km: km.toFixed(2), mi: (km * 0.621371).toFixed(2) };
    }

    // RENAMED TO runDashboardUpdate for Debouncing
    async function runDashboardUpdate(lat, lng, acc) {
        currentPos = { lat, lng };
        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
            const data = await res.json();
            els.addr.textContent = data.display_name || "Unknown Address";
        } catch(e) { els.addr.textContent = "..."; }

        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,wind_speed_10m`);
            const data = await res.json();
            const c = Math.round(data.current.temperature_2m);
            const f = Math.round((c * 9/5) + 32);
            const kph = Math.round(data.current.wind_speed_10m);
            const mph = Math.round(kph * 0.621371);
            els.temp.textContent = `${f}¬∞F / ${c}¬∞C`;
            els.wind.textContent = `${mph} mph / ${kph} km/h`;
        } catch(e) { els.temp.textContent = "N/A"; }

        try {
            // FIXED 504 TIMEOUT: Switched to faster mirror 'overpass.kumi.systems'
            const query = `[out:json][timeout:10];(node["amenity"~"police|hospital|fuel"](around:5000,${lat},${lng}););out body 10;`;
            const res = await fetch("https://overpass.kumi.systems/api/interpreter", { method: "POST", body: query });
            const data = await res.json();
            const types = { police: "Police", hospital: "Hospital", fuel: "Fuel" };
            let best = { police: null, hospital: null, fuel: null };
            data.elements.forEach(el => {
                const t = el.tags.amenity;
                const dist = getDistance(lat, lng, el.lat, el.lon);
                if (!best[t] || parseFloat(dist.km) < parseFloat(best[t].dist.km)) {
                    best[t] = { name: el.tags.name || "Local", dist };
                }
            });
            els.nearby.innerHTML = "";
            Object.keys(best).forEach(k => {
                const item = best[k];
                const div = document.createElement("div");
                div.className = "nearby-item";
                div.innerHTML = item ? 
                    `<div class="nearby-type">${types[k]}</div><div class="nearby-name">${item.name}</div><div class="nearby-dist">${item.dist.mi} mi / ${item.dist.km} km</div>` :
                    `<div class="nearby-type">${types[k]}</div><div class="nearby-name" style="color:#555">None</div>`;
                els.nearby.appendChild(div);
            });
        } catch(e) { 
            console.log("Nearby Error: ", e); 
            els.nearby.innerHTML = '<div style="color:#ef4444; font-size:12px; padding:10px;">Service temporarily unavailable due to high traffic.</div>';
        }
    }

    // WRAP UPDATE IN DEBOUNCE (1 second delay) for Heavy API Calls
    const updateDashboard = debounce((lat, lng, acc) => {
        runDashboardUpdate(lat, lng, acc);
    }, 1000);

    function initGPS() {
        if (!navigator.geolocation) { els.addr.textContent = "GPS not supported"; return; }
        navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude, accuracy, altitude } = pos.coords;
            
            // 1. INSTANT UPDATE: Update Coordinates UI Immediately (No Delay)
            els.lat.textContent = latitude.toFixed(5);
            els.lng.textContent = longitude.toFixed(5);
            els.acc.textContent = `¬±${Math.round(accuracy)}m`;
            
            // Update New Premium Dashboard Fields
            document.getElementById('alt-p').textContent = altitude ? Math.round(altitude) + 'm' : 'Sea Level';

            if (!map) {
                map = L.map("map", { zoomControl: false }).setView([latitude, longitude], 15);
                L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);
                marker = L.marker([latitude, longitude]).addTo(map);
                accuracyCircle = L.circle([latitude, longitude], { radius: accuracy }).addTo(map);
            } else {
                map.setView([latitude, longitude], 15);
                marker.setLatLng([latitude, longitude]);
                accuracyCircle.setLatLng([latitude, longitude]);
                accuracyCircle.setRadius(accuracy);
            }
            
            // 2. INSTANT UPDATE: Run Address/Weather immediately on first load
            // Bypassing the debounce wrapper to fix "Address not appearing" issue
            runDashboardUpdate(latitude, longitude, accuracy);
            
        }, (err) => { els.addr.textContent = "Please enable Location Services."; }, { enableHighAccuracy: true });
        fetch("https://ipapi.co/json/").then(r=>r.json()).then(d=>{
            els.ip.textContent = d.ip;
            els.isp.textContent = d.org;
        });
    }

    document.getElementById("refresh-btn").addEventListener("click", () => location.reload());
    document.getElementById("copy-coords-btn").addEventListener("click", () => {
        navigator.clipboard.writeText(`${els.lat.textContent}, ${els.lng.textContent}`);
        alert("Coordinates Copied!");
    });
    document.getElementById("copy-addr").addEventListener("click", () => {
        navigator.clipboard.writeText(els.addr.textContent);
        alert("Address Copied!");
    });
    // MODIFIED: Original listener maintained, but enhanced SOS logic added below
    document.getElementById("sos-btn").addEventListener("click", () => {
        // Trigger New SOS Mode instead of just sharing
        triggerSOSMode();
    });
    initGPS();

    /* =========================================
       NEW DEVELOPER MODE MODULES & FUNCTIONS
       ========================================= */

    /* --- OFFLINE MODE HANDLER --- */
    window.addEventListener('offline', () => {
        document.getElementById('offline-indicator').style.display = 'inline-block';
        // Try to load cached pins
        loadPins();
    });
    window.addEventListener('online', () => {
        document.getElementById('offline-indicator').style.display = 'none';
    });

    /* --- UI TOGGLER --- */
    function toggleModule(id) {
        document.querySelectorAll('.new-module-container').forEach(el => {
            if (el.id !== id) el.classList.remove('active-mod');
        });
        const mod = document.getElementById(id);
        mod.classList.toggle('active-mod');
        
        // Populate share link if opening share mod
        if (id === 'share-mod' && currentPos) {
            document.getElementById('share-url-input').value = `https://tellmylocation.com/?lat=${currentPos.lat}&lng=${currentPos.lng}`;
        }
    }

    /* --- MODULE: SHAREABLE LINK --- */
    function copyShareLink() {
        const input = document.getElementById('share-url-input');
        input.select();
        document.execCommand('copy');
        alert('Link copied to clipboard!');
    }
    
    function shareSocial(platform) {
        if (!currentPos) return alert("Waiting for location...");
        const url = `https://tellmylocation.com/?lat=${currentPos.lat}&lng=${currentPos.lng}`;
        const msg = `My current location: ${url}`;
        let link = "";
        
        if (platform === 'wa') link = `https://wa.me/?text=${encodeURIComponent(msg)}`;
        if (platform === 'sms') link = `sms:?body=${encodeURIComponent(msg)}`;
        if (platform === 'tg') link = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent("My Location")}`;
        
        window.open(link, '_blank');
    }

    function startLiveTrack() {
        // STUB: This would connect to a backend websocket
        const btn = document.getElementById('live-trk-btn');
        btn.innerText = "üì° Tracking Active (15m)";
        btn.style.background = "#ef4444";
        setTimeout(() => {
            btn.innerText = "üì° Start Live (15m)";
            btn.style.background = "";
            alert("Live tracking session ended.");
        }, 15 * 60 * 1000); // 15 mins
        alert("Live tracking started. Session ID: " + Math.random().toString(36).substr(2, 9));
    }

    /* --- MODULE: DRIVER MODE --- */
    let watchId = null;
    function enableDriverStats() {
        if (watchId) return;
        watchId = navigator.geolocation.watchPosition(pos => {
            const spd = pos.coords.speed; // m/s
            const hdg = pos.coords.heading;
            
            if (spd !== null) {
                const mph = Math.round(spd * 2.23694);
                document.getElementById('drv-speed').innerText = mph;
            }
            if (hdg !== null && !isNaN(hdg)) {
                const dirs = ['N','NE','E','SE','S','SW','W','NW'];
                const ix = Math.round(((hdg %= 360) < 0 ? hdg + 360 : hdg) / 45) % 8;
                document.getElementById('drv-dir').innerText = dirs[ix];
            }
        }, null, {enableHighAccuracy: true});
    }
    // Activate driver stats when module opens (conceptually)
    document.querySelector('button[onclick="toggleModule(\'driver-mod\')"]').addEventListener('click', enableDriverStats);

    function openMapSearch(query) {
        if (!currentPos) return;
        window.open(`https://www.google.com/maps/search/${query}/@${currentPos.lat},${currentPos.lng},15z`);
    }

    function shareETA() {
        const min = prompt("Minutes to arrival?", "15");
        if (!min) return;
        const msg = `I will arrive in approx ${min} mins. Track me: https://tellmylocation.com/?lat=${currentPos.lat}&lng=${currentPos.lng}`;
        window.location.href = `sms:?body=${encodeURIComponent(msg)}`;
    }
    
    function shareLocationSimple() {
        shareSocial('sms');
    }

    /* --- MODULE: HIKER MODE --- */
    function dropPin() {
        if (!currentPos) return alert("No GPS signal.");
        const pins = JSON.parse(localStorage.getItem('hiker_pins') || "[]");
        const pin = {
            time: new Date().toLocaleTimeString(),
            lat: currentPos.lat,
            lng: currentPos.lng
        };
        pins.push(pin);
        localStorage.setItem('hiker_pins', JSON.stringify(pins));
        loadPins();
    }

    function loadPins() {
        const list = document.getElementById('pin-list');
        list.innerHTML = "";
        const pins = JSON.parse(localStorage.getItem('hiker_pins') || "[]");
        pins.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = 'pin-item';
            div.innerHTML = `<span>üìç Pin ${i+1} (${p.time})</span> <a href="https://maps.google.com/?q=${p.lat},${p.lng}" target="_blank" style="color:#38bdf8">Map</a>`;
            list.appendChild(div);
        });
    }
    
    function clearPins() {
        if(confirm("Delete all pins?")) {
            localStorage.removeItem('hiker_pins');
            loadPins();
        }
    }
    loadPins(); // Init load

    /* --- MODULE: MEET FRIEND --- */
    function calcFriendDist() {
        const val = document.getElementById('friend-input').value;
        // Simple parser for "lat,lng"
        let lat2, lng2;
        
        // Regex to find coords in a string
        const match = val.match(/([-+]?\d{1,2}\.\d+),\s*([-+]?\d{1,3}\.\d+)/);
        if (match) {
            lat2 = parseFloat(match[1]);
            lng2 = parseFloat(match[2]);
        } else if (val.includes('lat=') && val.includes('lng=')) {
            const url = new URL(val);
            lat2 = parseFloat(url.searchParams.get('lat'));
            lng2 = parseFloat(url.searchParams.get('lng'));
        } else {
            return alert("Could not parse coordinates. Please use 'lat,lng' format.");
        }

        if (!currentPos) return alert("Your location is not set yet.");
        
        const dist = getDistance(currentPos.lat, currentPos.lng, lat2, lng2);
        
        // Calc Midpoint
        const midLat = (currentPos.lat + lat2) / 2;
        const midLng = (currentPos.lng + lng2) / 2;
        
        const res = document.getElementById('friend-res');
        res.innerHTML = `
            <strong>Distance:</strong> ${dist.mi} mi / ${dist.km} km<br>
            <strong>Midpoint:</strong> <a href="https://www.google.com/maps/search/coffee/@${midLat},${midLng},14z" target="_blank" style="color:#38bdf8; text-decoration:underline;">Find Meetup Spot</a>
        `;
    }

    /* --- MODULE: SOS MODE --- */
    let sosAudio = null;
    function triggerSOSMode() {
        const overlay = document.getElementById('sos-overlay');
        overlay.style.display = 'flex';
        
        // Auto share (Standardized)
        if (navigator.share && currentPos) {
            navigator.share({
                title: 'EMERGENCY LOCATION',
                text: 'Emergency Location:',
                url: `https://tellmylocation.com/?lat=${currentPos.lat}&lng=${currentPos.lng}`
            }).catch(console.log);
        }
    }

    function stopSOS() {
        document.getElementById('sos-overlay').style.display = 'none';
        if (sosAudio) {
            sosAudio.pause();
            sosAudio = null;
        }
    }

    /* --- CHECK URL PARAMS ON LOAD --- */
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        const pLat = params.get('lat');
        const pLng = params.get('lng');
        if (pLat && pLng) {
            // If someone shared a link, maybe show it differently or map it
            // For now we just focus the map there if logic allows, or alert
            console.log("Opened via shared link:", pLat, pLng);
            setTimeout(() => {
               if(map) {
                   L.marker([pLat, pLng], {color:'red'}).addTo(map).bindPopup("Shared Location").openPopup();
                   map.setView([pLat, pLng], 15);
               }
            }, 2000);
        }
    };
</script>

<script>
    // New Feature Module: Weather & Alerts
    (function() {
        // Init mini map var
        let miniMap = null;

        const weatherCodes = {
            0: "‚òÄÔ∏è Clear", 1: "üå§Ô∏è Mostly Clear", 2: "‚õÖ Partly Cloudy", 3: "‚òÅÔ∏è Overcast",
            45: "üå´Ô∏è Fog", 48: "üå´Ô∏è Rime Fog",
            51: "DRIZZLE", 53: "DRIZZLE", 55: "DRIZZLE",
            61: "Rain", 63: "Rain", 65: "Heavy Rain",
            71: "Snow", 73: "Snow", 75: "Heavy Snow",
            80: "Showers", 81: "Showers", 82: "Showers",
            95: "STORM", 96: "STORM", 99: "HEAVY STORM"
        };

        function getDesc(code) { return weatherCodes[code] || "Unknown"; }

        function initPreviewMap(lat, lng) {
            if(!miniMap) {
                // Initialize the preview map
                miniMap = L.map('mini-map', { zoomControl: false, attributionControl: false }).setView([lat, lng], 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19
                }).addTo(miniMap);
                L.marker([lat, lng]).addTo(miniMap);
                
                // Expose to window for buttons
                window.mapPreview = miniMap;
                window.lastLat = lat;
                window.lastLng = lng;
            } else {
                miniMap.setView([lat, lng], 13);
                window.lastLat = lat;
                window.lastLng = lng;
                // In a real app we'd update the marker position too, but for a preview snippet, re-centering is key.
            }
        }

        // DEBOUNCE REMOVED for this function to ensure initial load works immediately
        function fetchExtendedWeather(lat, lng) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,uv_index&hourly=temperature_2m,weather_code,precipitation_probability&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto&forecast_days=1`;
            
            fetch(url).then(r=>r.json()).then(data => {
                document.getElementById('weather-loading').style.display = 'none';
                document.getElementById('weather-content').style.display = 'block';

                // Current
                document.getElementById('wx-temp').innerText = Math.round(data.current.temperature_2m) + "¬∞F";
                document.getElementById('wx-desc').innerText = getDesc(data.current.weather_code);
                document.getElementById('wx-wind').innerText = Math.round(data.current.wind_speed_10m) + " mph";
                document.getElementById('wx-hum').innerText = data.current.relative_humidity_2m + "%";
                document.getElementById('wx-uv').innerText = data.current.uv_index;

                // Alerts Logic (Simulated based on severity of current data, as Open-Meteo alerts endpoint requires different handling/parsing)
                const panel = document.getElementById('wx-alert-panel');
                const msg = document.getElementById('wx-alert-msg');
                // Simple logic: if code is storm, or wind > 40mph, or UV > 8
                if(data.current.weather_code >= 95 || data.current.wind_speed_10m > 40 || data.current.uv_index > 8) {
                    panel.style.borderColor = "#ef4444";
                    panel.style.background = "rgba(239, 68, 68, 0.1)";
                    msg.innerText = "‚ö†Ô∏è CAUTION: High winds, storm, or UV detected.";
                    msg.style.color = "#fca5a5";
                } else {
                    panel.style.borderColor = "#10b981";
                    panel.style.background = "rgba(16, 185, 129, 0.05)";
                    msg.innerText = "Clear ‚Äî No severe warnings active.";
                    msg.style.color = "#cbd5e1";
                }

                // Hourly Forecast (Next 12h)
                const hourlyDiv = document.getElementById('wx-hourly');
                hourlyDiv.innerHTML = "";
                const nowHour = new Date().getHours();
                
                let startIndex = nowHour;
                
                for(let i=0; i<12; i++) { 
                    let idx = startIndex + i;
                    if(idx >= data.hourly.time.length) break;
                    
                    const t = Math.round(data.hourly.temperature_2m[idx]);
                    const code = data.hourly.weather_code[idx];
                    const pop = data.hourly.precipitation_probability[idx];
                    
                    const el = document.createElement('div');
                    el.style = "background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; min-width:60px; text-align:center; flex-shrink:0;";
                    el.innerHTML = `
                        <div style="font-size:10px; color:#94a3b8; margin-bottom:4px;">+${i}h</div>
                        <div style="font-size:16px; margin-bottom:2px;">${(code > 50) ? 'üåßÔ∏è' : ((code < 3) ? '‚òÄÔ∏è' : '‚òÅÔ∏è')}</div>
                        <div style="font-size:13px; font-weight:700;">${t}¬∞</div>
                        <div style="font-size:9px; color:#38bdf8;">${pop}%</div>
                    `;
                    hourlyDiv.appendChild(el);
                }

            }).catch(e => {
                document.getElementById('weather-loading').innerText = "Weather unavailable.";
            });
        }

        // Initialize listener
        // We poll for DOM changes because variable scope between script tags can be tricky with 'let'
        const checkLoc = setInterval(() => {
            const latTxt = document.getElementById('lat-val').textContent;
            const lngTxt = document.getElementById('lng-val').textContent;
            
            if(latTxt !== '‚Äî' && !isNaN(parseFloat(latTxt))) {
                const lat = parseFloat(latTxt);
                const lng = parseFloat(lngTxt);
                
                initPreviewMap(lat, lng);
                fetchExtendedWeather(lat, lng);
                clearInterval(checkLoc);
            }
        }, 1000);
    })();
</script>
</body>
</html>
